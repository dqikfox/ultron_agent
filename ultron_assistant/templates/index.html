<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ultron Assistant - Advanced AI Interface</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
    
    <!-- Custom Ultron CSS -->
    <link href="/static/css/ultron.css" rel="stylesheet">
    
    <!-- Socket.IO Client -->
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ¤–</text></svg>">
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#d32f2f">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Ultron Assistant">
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="Ultron Assistant - Advanced AI-powered assistant with voice interaction and automation capabilities">
    <meta name="keywords" content="AI, Assistant, Automation, Voice, Ultron, Chatbot">
    <meta name="author" content="Ultron Assistant">
</head>
<body class="bg-dark text-light">
    <!-- Loading Overlay -->
    <div id="loading-overlay" class="position-fixed top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center" style="background: rgba(10, 10, 10, 0.95); z-index: 9999;">
        <div class="text-center">
            <div class="loading mb-3"></div>
            <h4 class="text-danger">Initializing Ultron Assistant...</h4>
            <p class="text-muted">Connecting to AI systems...</p>
        </div>
    </div>

    <!-- Main Container -->
    <div class="container py-4">
        <!-- Header -->
        <header class="text-center mb-4">
            <h1 class="display-4 text-danger mb-2">
                <i class="bi bi-robot me-3"></i>
                Ultron Assistant
            </h1>
            <p class="lead text-muted">
                Advanced AI Interface with Voice Interaction & Automation
            </p>
            
            <!-- Status Bar -->
            <div id="status-bar" class="d-flex justify-content-center align-items-center gap-3 mt-3">
                <span class="badge bg-secondary">
                    <span class="status-indicator online"></span>
                    System Online
                </span>
                <span class="badge bg-secondary">
                    <i class="bi bi-mic"></i>
                    Voice Ready
                </span>
                <span class="badge bg-secondary">
                    <i class="bi bi-gear"></i>
                    Automation Active
                </span>
            </div>
        </header>

        <!-- Chat Interface -->
        <main>
            <!-- Chat Box -->
            <div id="chat-box" class="border rounded p-3 mb-3 bg-secondary overflow-auto position-relative" style="height: 60vh;">
                <!-- Messages will be dynamically added here -->
                <div class="text-center text-muted mt-5">
                    <i class="bi bi-chat-dots-fill fs-1 mb-3 d-block opacity-50"></i>
                    <p>Welcome to Ultron Assistant</p>
                    <small>Start typing or use voice input to begin...</small>
                </div>
            </div>

            <!-- Input Area -->
            <div class="row g-2">
                <div class="col">
                    <div class="input-group">
                        <textarea 
                            id="user-input" 
                            class="form-control bg-dark text-light border-danger" 
                            placeholder="Ask Ultron anything... (Ctrl+Enter to send)"
                            rows="1"
                            style="resize: none; max-height: 150px;"
                            autocomplete="off"
                            spellcheck="true"></textarea>
                        <button id="send-btn" class="btn btn-danger px-4" type="button" title="Send message (Ctrl+Enter)">
                            <i class="bi bi-send-fill"></i>
                        </button>
                    </div>
                </div>
                <div class="col-auto">
                    <button id="mic-btn" class="btn btn-outline-danger" type="button" title="Voice input (Ctrl+M)">
                        <i class="bi bi-mic"></i>
                    </button>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="row g-2 mt-3">
                <div class="col-6 col-md-3">
                    <button class="btn btn-sm btn-outline-secondary w-100 quick-action" data-action="take screenshot">
                        <i class="bi bi-camera me-1"></i>
                        Screenshot
                    </button>
                </div>
                <div class="col-6 col-md-3">
                    <button class="btn btn-sm btn-outline-secondary w-100 quick-action" data-action="open calculator">
                        <i class="bi bi-calculator me-1"></i>
                        Calculator
                    </button>
                </div>
                <div class="col-6 col-md-3">
                    <button class="btn btn-sm btn-outline-secondary w-100 quick-action" data-action="what time">
                        <i class="bi bi-clock me-1"></i>
                        Time
                    </button>
                </div>
                <div class="col-6 col-md-3">
                    <button class="btn btn-sm btn-outline-secondary w-100 quick-action" data-action="system info">
                        <i class="bi bi-info-circle me-1"></i>
                        System
                    </button>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="text-center mt-4 pt-4 border-top border-secondary">
            <div class="row g-3 align-items-center">
                <div class="col-md-4">
                    <small class="text-muted">
                        <i class="bi bi-shield-check me-1"></i>
                        Secure AI Processing
                    </small>
                </div>
                <div class="col-md-4">
                    <div class="btn-group" role="group">
                        <button id="clear-chat-btn" class="btn btn-sm btn-outline-secondary" title="Clear chat (Ctrl+K)">
                            <i class="bi bi-trash"></i>
                        </button>
                        <button id="export-chat-btn" class="btn btn-sm btn-outline-secondary" title="Export chat">
                            <i class="bi bi-download"></i>
                        </button>
                        <button id="settings-btn" class="btn btn-sm btn-outline-secondary" title="Settings">
                            <i class="bi bi-gear"></i>
                        </button>
                    </div>
                </div>
                <div class="col-md-4">
                    <small class="text-muted">
                        Powered by <strong class="text-danger">Ollama</strong> & <strong class="text-danger">FastAPI</strong>
                    </small>
                </div>
            </div>
            
            <!-- Keyboard Shortcuts Help -->
            <div class="mt-3">
                <small class="text-muted">
                    <strong>Shortcuts:</strong>
                    <kbd class="bg-secondary">Ctrl+Enter</kbd> Send |
                    <kbd class="bg-secondary">Ctrl+K</kbd> Clear |
                    <kbd class="bg-secondary">Ctrl+M</kbd> Voice |
                    <kbd class="bg-secondary">Esc</kbd> Stop
                </small>
            </div>
        </footer>
    </div>

    <!-- Settings Modal -->
    <div class="modal fade" id="settingsModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content bg-dark border-danger">
                <div class="modal-header border-danger">
                    <h5 class="modal-title text-danger">
                        <i class="bi bi-gear me-2"></i>
                        Ultron Settings
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row g-3">
                        <div class="col-12">
                            <label class="form-label">Voice Recognition</label>
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="voiceEnabled" checked>
                                <label class="form-check-label" for="voiceEnabled">
                                    Enable voice input
                                </label>
                            </div>
                        </div>
                        <div class="col-12">
                            <label class="form-label">Auto-scroll</label>
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="autoScroll" checked>
                                <label class="form-check-label" for="autoScroll">
                                    Auto-scroll to new messages
                                </label>
                            </div>
                        </div>
                        <div class="col-12">
                            <label for="voiceTimeout" class="form-label">Voice Timeout (seconds)</label>
                            <input type="range" class="form-range" id="voiceTimeout" min="5" max="30" value="10">
                            <div class="d-flex justify-content-between">
                                <small>5s</small>
                                <small id="voiceTimeoutValue">10s</small>
                                <small>30s</small>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer border-danger">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-danger" id="saveSettings">Save Settings</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Custom Chat JS -->
    <script src="/static/js/chat.js"></script>
    
    <!-- Additional UI Enhancements -->
    <script>
        // Hide loading overlay when page is ready
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                const loadingOverlay = document.getElementById('loading-overlay');
                if (loadingOverlay) {
                    loadingOverlay.style.opacity = '0';
                    setTimeout(() => loadingOverlay.remove(), 300);
                }
            }, 1500);
        });

        // Quick action buttons
        document.addEventListener('DOMContentLoaded', () => {
            const quickActions = document.querySelectorAll('.quick-action');
            quickActions.forEach(btn => {
                btn.addEventListener('click', () => {
                    const action = btn.dataset.action;
                    if (window.ultronChat) {
                        window.ultronChat.userInput.value = action;
                        window.ultronChat.sendMessage();
                    }
                });
            });

            // Additional UI controls
            document.getElementById('clear-chat-btn').addEventListener('click', () => {
                if (window.ultronChat && confirm('Clear chat history?')) {
                    window.ultronChat.clearChat();
                }
            });

            document.getElementById('export-chat-btn').addEventListener('click', () => {
                if (window.ultronChat) {
                    window.ultronChat.exportChat();
                }
            });

            document.getElementById('settings-btn').addEventListener('click', () => {
                const modal = new bootstrap.Modal(document.getElementById('settingsModal'));
                modal.show();
            });

            // Voice timeout slider
            const voiceTimeoutSlider = document.getElementById('voiceTimeout');
            const voiceTimeoutValue = document.getElementById('voiceTimeoutValue');
            voiceTimeoutSlider.addEventListener('input', () => {
                voiceTimeoutValue.textContent = voiceTimeoutSlider.value + 's';
            });
        });

        // Escape key handling
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                if (window.ultronChat && window.ultronChat.isListening) {
                    // Stop voice input
                    window.ultronChat.micBtn.click();
                }
            }
        });
    </script>
</body>
</html>
